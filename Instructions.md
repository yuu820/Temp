English learning system仕様書　

1目的
	生成Geminiを利用した英語の長文教材の作成、自由英作文の添削を通して利用者の英語能力を向上させることを		目的とする。
2使用技術
	HTML CSS JS
	React NodeJS
	SQlite3
3利用者登録
	利用者は後述する管理画面上に管理者がログイン情報を登録することで行う
	利用者には固有のユーザーIDを割り当て、そのアカウントにログインするパスワードを登録する形で登録ができる
4利用者ロール
	利用者には以下の4つのロールが割り当てられ、そのロールによって機能制限等を受ける
	1 アクセス数ロール:1日当たりの生成AIのリクエスト数の制限
		無制限:制限なし
		制限付き:後述する管理画面上によって設定されたアクセス数までしか1日利用できない。
		制限は日本時間0時にリセットが行われる。
	2優先度:生成AI自体にレート制限があるため後述の方法にて待ちが発生するがその優先度
		優先:優先度が一番高くロールが通常の利用者が待っていた場合、待ち列の一番前へと移動できる
		通常:待ち列が発生していた場合はFIFO方式でリクエストを処理する
	3利用者種別
		管理者:管理画面へのアクセス権を持ち、管理画面内の設定を変更できる
		ヘルパー:管理画面へのアクセス権を持つが、管理画面内の設定は変更できない
		一般ユーザー:管理画面へのアクセス権を持たない
	4Proアクセス
		Proアクセス有り:Gemini2.5Proが利用可能	
		Proアクセス無し:Gemini2.5Proアクセス不可
5利用者データベース
	利用者の情報はデータベースにて管理される。
	管理内容は、ユーザーID、パスワード、表示名、ロールである
	このデータベースに基づきログイン認証が行われる
6管理画面
	管理画面上では利用者情報の登録、変更、レート制限の変更、運用情報、データベースの確認、変更、削除が行える
	それぞれ利用者管理、レート制限、運用情報、データベースと分け管理を行う
	レート制限では下記に示す2つに何秒当たりに1件通すかを決定できるほか、待ちリストの利用を直近1分間のアクセスの超過のしきい値を設定できる
	運用情報では、待ち情報や、同接数などを確認できる
	また利用者情報、データベースに各種ソート機能を備え、検索、並ぶかえを行えるようにする
7待機リスト
	待機リストはレート制限に基づいて決定されたしきい値を超えた場合にリクエストごとに待ちが発生する
	待機リストは問題作成待機リストと問題添削待機リストの２つがあり行われた行動ごとにリクエストが仕切られる
	それぞれ管理画面で設定されたレートでリクエストを行う。
	両方の待機リストがなくなり、かつそれぞれ1分間のリクエストがしきい値を下回った場合は待機リストが終了、リクエストをすぐに通すようにする。
	どちらか片方の待機リストがなくなり、もう一方の待機リストには並んでいる場合は、あくまで本来のリクエスト枠を優先はしつつ空いた枠を混んでいる待機リストのリクエストを処理するために利用する。
8長文問題機能
	長文問題機能では長文の問題を作成し添削するまでを行う。
	問題作成では語数と難易度、種類、テーマを設定して行う
	語数は1000語以下で指定でき1000語以上が指定された場合は1000語として扱う
	難易度は、高校生の定期テストレベル、共通テストレベル、二次試験初級レベル(地方国立程度)、二次試験上級レベル(旧帝、難関国立レベル)から選べる
	問題の種類は、文法4択、語彙4択、内容一致4択、並び替え、文法記述、語彙記述、日本語訳をそれぞれ問題数を指定して作成する
　テーマは自由選択で書き込んだ場合はそのテーマで作成する
	語数、難易度、問題の種類は強制で入力されていない場合は作成をしない。
	作成された問題は問題数分の回答枠を作成し、その枠内にそれぞれ回答をする。
	最後の枠の下に提出ボタンを設定し、空白な回答枠がなければ添削を行う
	また提出ボタン、中断ボタンを設置し、ユーザーのcookie等に保存することで、途中で再開できるようにする
	添削は内容が正しく、要点を押さえており、文法上の問題がなければ、満点を与える
	添削時に英文の日本語訳、要点、重要文法事項も表示する
	問題の作成は問題作成待機リスト、問題の添削は、問題添削待機リストへ必要な場合は誘導する
	添削は非同期処理にて行い、ユーザーが添削までタブを開いたまま待つ必要はないようにする
	下記に示すタスクデータベースへの登録を行う
9自由英作文機能
	自由英作文ではテーマを設定して行う。
	テーマは自由選択で指定しない場合は何かしらのテーマで問題を作成する
	テーマを指定したらそれに基づいて問題を作成する。
	問題の添削は以下の基準で行う。
		1内容、課題で求められている内容(意見とそれに沿った理由)が含まれているかどうか
		2構成、英文の構成がわかりやすく論理的であるか
		3語彙、課題に相応しい語彙を正しく使えているか
		4文法、文構造にバリエーションやそれらを正しく使えているか
	にて採点する
	回答枠が右下部には入力語数を表示する。
	また回答枠下部に添削ボタンを表示し、回答枠が空白でなければ添削を行う。
	また添削ボタン、中断ボタンを設置し、ユーザーのcookie等に保存することで、途中で再開できるようにする
	問題の作成は問題作成待機リスト、問題の添削は、問題添削待機リストへ必要な場合は誘導する
	添削は非同期処理にて行い、ユーザーが添削までタブを開いたまま待つ必要はないようにする
	下記に示すタスクデータベースへの登録を行う
10タスクデータベース
	タスクデータベースでは長文タスクデータベースと自由英作文タスクデータベースに分けて行う。
	1長文タスクデータベース
		長文タスクデータベースにはタスクID、生成したユーザのユーザーID、語数、難易度、問題の種類ごとの問題数、テーマ、生成した英文、問題、添削、ユーザーの回答を記録する
	2自由英作文タスクデータベース
		自由英作文データベースにはタスクID、ユーザーID、テーマ、ユーザーの入力した英文、添削を記録する。
	タスクIDはタスクごとに割り当て、被りのないようにする。
11タスク管理
	タスク管理ではユーザーが自分の行ったタスクを一覧に表示し各タスクに対しての添削を確認したり、解き直しをしたりできるようにする。
	1添削の確認
		ユーザーが添削を依頼し、非同期処理にて処理が終了後、その添削内容について確認ができる
	2解き直し
		解き直しではユーザーが行ったタスクに対し同じ内容でもう一度解くことができる機能である
		解き直し機能では以下の３つの操作が行える
		1英語長文にて英語の長文と問題をそのまま解き直す機能
		2英語の長文にて英語の長文はそのまま、問題を作り変えて、解き直す機能
		3英語の自由英作文にて問題はそのまま、解き直す機能
		いずれの場合も解き直しが行われた際は新たなタスクとして扱い、タスクIDも新規で作成する。
		作成時に、必要に応じて問題の情報や文章等をデータベースへ登録する。
	3再開
		再開機能では、中断されたタスクに対して途中から再開できる機能である。
12備考
	スマホでの利用も前提としているため、スマートフォンでの利用時にUIが崩れないようにする
	HTMLのタグやJSのコードを回答枠やデータベースに格納してもバグらないように対策する
	

	
